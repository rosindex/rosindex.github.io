<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="A community-maintained index of known ROS packages.
">

    <link rel="canonical" href="http://rosindex.github.io/p/mongodb_store/">
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">

    <script type="text/javascript" src="/js/jquery.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/js/jquery-cookie-1.4.1/jquery.cookie.js" type="text/javascript"></script>

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">ROS Index</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        <!--<a class="page-link" href="/p/mongodb_store/index.html"></a>-->
        <a class="page-link" href="/packages">Packages</a>
        <a class="page-link" href="/repos">Repositories</a>
        <a class="page-link" href="/search">Search</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin:20px">
  <div class="row">
    <ol class="breadcrumb">
      <li><a href="/">Home</a></li>
      <li><a href="/packages">Packages</a></li>
      <li><a href="/packages/mongodb_store">mongodb_store</a></li>
      <li class="active">rosdistro</li>
    </ol>
  </div>
  <div class="row">
    <div class="well well-sm">
  <table class="table-condensed">
    <tbody>
      <tr>
        <!--<td><span class="pull-right">description</span></td>-->
        <td>
          <h4>mongodb_store <small></small></h4>
          
        </td>
      </tr>
      
        <tr>
          <td>
<div id="repo-switch" class="btn-group btn-group-justified" role="group">
  <div class="btn-group" role="group">
    <div class="dropdown">
      <! -- TODO: add disabled when only 1 version is known -->
      <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">
        <span class="pull-left">
          <span class="glyphicon glyphicon-star"></span>
          rosdistro ( https://github.com/strands-project/mongodb_store.git )
        </span>
        <span class="pull-right"><span class="caret"></span></span>
      </button>
      <ul class="dropdown-menu" role="menu">
        
          <li role="presentation">
          <a id="rosdistro" role="menuitem" tabindex="-1" href="/p/mongodb_store/rosdistro" data="rosdistro">
              <span class="glyphicon glyphicon-star"></span>
              rosdistro ( https://github.com/strands-project/mongodb_store.git )
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
</td>
        </tr>
      
      
        <tr>
          <td>
            

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
  <label id="indigo-option" class="distro-button btn btn-xs btn-default" href="#indigo" data="indigo">
      <input type="radio" name="options" id="indigo-radio" autocomplete="off"> indigo
    </label>
  
  <label id="hydro-option" class="distro-button btn btn-xs btn-primary" href="#hydro" data="hydro">
      <input type="radio" name="options" id="hydro-radio" autocomplete="off"> hydro
    </label>
  
  <label id="groovy-option" class="distro-button btn btn-xs btn-primary" href="#groovy" data="groovy">
      <input type="radio" name="options" id="groovy-radio" autocomplete="off"> groovy
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-default" data-toggle="dropdown" id="older-distro-button">
    <input type="radio" name="options" autocomplete="off">
    <span id="older-label">Older</span>
    <span class="caret"></span>
  </label>
  <ul class="dropdown-menu" role="menu">
    
      <li data="fuerte" id="fuerte-option" class="disabled older-distro-option"  href="#fuerte">
      <a href="#fuerte" data="fuerte" id="fuerte-button">fuerte</a>
      </li>
    
      <li data="electric" id="electric-option" class="disabled older-distro-option"  href="#electric">
      <a href="#electric" data="electric" id="electric-button">electric</a>
      </li>
    
      <li data="diamondback" id="diamondback-option" class="disabled older-distro-option"  href="#diamondback">
      <a href="#diamondback" data="diamondback" id="diamondback-button">diamondback</a>
      </li>
    
      <li data="c-turtle" id="c-turtle-option" class="disabled older-distro-option"  href="#c-turtle">
      <a href="#c-turtle" data="c-turtle" id="c-turtle-button">c-turtle</a>
      </li>
    
  </ul>
</div>
</div>

          </td>
        </tr>
      
    </tbody>
  </table>
</div>

  </div>
  <div class="row">
    
      <div class="distro distro-indigo">
        
        <em>No branch for distro <strong>indigo</strong>. Known supported distros are highlighted in the buttons above.</em>
        
      </div>
    
      <div class="distro distro-hydro">
        
          
          <div class="panel panel-default">
            <div class="panel-heading">README</div>
            <div class="readme-" style="margin: 20px">
              <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="rendered-markdown">
<h1>mongodb_store</h1>

<p>This package wraps up MongoDB database server in ROS, allowing it to be used to store configuration parameters.</p>

<p>Two nodes are provided:
- mongodb_server.py
- config_manager.py</p>

<p>These node depends on MongoDB and the Python client libraries (&gt;=2.3). Install by:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo apt-get install python-pymongo mongodb
</code></pre></div>
<p>If this does not give the required version, you can use:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo pip install pymongo
</code></pre></div>
<h2>Running the mongodb_server</h2>

<p>The start the datacentre:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">rosparam set mongodb_port 62345
rosparam set mongodb_host bob # note that if using multiple machines, 'localhost' is no good

rosrun mongodb_store mongodb_server.py
</code></pre></div>
<p>By default, the mongod database will be stored in <code>/opt/strands/mongodb_store</code>. This can be overridden by setting the private parameter ~database_path for the node. If it is the first time that the database is used, be sure to first run</p>

<p><code>mkdir  /opt/strands/mongodb_store
</code> </p>

<p>If you prefer to use different mongodb instance, set the mongodb_* parameters accordingly.</p>

<h2>Config Manager Overview</h2>

<p>The config manager provides a centralised way to store robot application parameters, with optional site-specific overrides. All configurations are stored inside the mongodb_store mongodb, within a database named "configs". </p>

<p>Two levels of parameters are considered:</p>

<p>1) Global default parameters. 
These should be "working defaults" - so all essential parameters at least have a default value. For example, if a robot application requires some calibration data then default values should be provided.
Default parameters can be shared among sites and stored inside a shared ROS package. When the config manager is started, all .yaml files stored in a 'defaults' folder will be examined. Any new default parameters will automatically be inserted into the "defaults" collection within the configs database. The defaults folder should be supplied as a private parameter: <code>~defaults_path</code> either set to a system path or in the form <code>pkg://ros_package_name/inside/package</code>.</p>

<p>2) Local parameters.
These parameters override the same named  global default parameters, allowing site-specific parameter setting. They are stored within the database inside the "local" collection.</p>

<p>At start up, the config manager places all parameters onto the ros parameter server to allow interoperability with existing software. Parameters can also be queried using the /config_manager/get_param service, or by directly connection to and querying the mongo database server.</p>

<p>Likewise, local parameter overrides can be set using the /config_manager/set_param service or by directly editing the "local" collection in the configs database.</p>

<h2>Running config manager</h2>

<p>To start the config manager, make sure that you have the mongo db running then:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">rosrun mongodb_store config_manager.py _defaults_path:=pkg://my_package/defaults
</code></pre></div>
<p>This will load all parameters onto the ros parameter server, which can be checked with:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">rosparam list
</code></pre></div>
<h2>Reading parameters</h2>

<p>There are three methods to access parameter values:
1) Use the copy on the ros parameter server:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">rosparam get /my/parameter
</code></pre></div>
<p>and likewise with the rospy and roscpp libraries.
2) Use the config_manager service:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">rosservice call /config_manager/get_param "param_name: '/my/parameter'" 
</code></pre></div>
<p>3) Using the database server directly</p>

<h2>Setting parameters</h2>

<p>Default parameters are set by placing them in the yaml files in the defaults directory in mongodb_store. This way, default parameters are added to the github repo and shared between all users.</p>

<p>The local parameter overrides can be set in 2 ways:
1) Using the config_manager service:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">rosservice call /config_manager/set_param "param: '{\"path\":\"/chris\",\"value\":43}'" 
</code></pre></div>
<p>Note the syntax of the parameter: it is a json representation of a dictionary with path and value keys.</p>

<p>2) Using the config_manager service:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">rosservice call /config_manager/save_param name_of_the_parameter_to_be_saved
</code></pre></div>
<p>Note: This will save the current value of the parameter into the locals database</p>

<p>3) Using the database server directly</p>

<h1>Launch files</h1>

<p>Both mongodb and config_manager can be started together using the datacentre.launch file:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">HOSTNAME=yourhost roslaunch mongodb_store datacentre.launch db_path:=/path/to/db db_port:=62345
</code></pre></div>
<p>The HOSTNAME env variable is required; db_path will default to /opt/strands/mongodb_store and db_port will default to 62345. </p>

<h1>Replication</h1>

<p>If the constructor arcgument to the message store node <code>replicate_on_write</code> is set to true, replication of the message store parts of the datacentre is done manually to allow different content to appear on different hosts. A list of hosts and ports where replications should be made can be set via the <code>mongodb_store_extras</code> parameter:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">mongodb_store_extras</span><span class="p-Indicator">:</span> <span class="p-Indicator">[[</span><span class="s">"localhost"</span><span class="p-Indicator">,</span> <span class="nv">62344</span><span class="p-Indicator">],</span> <span class="p-Indicator">[</span><span class="s">"localhost"</span><span class="p-Indicator">,</span> <span class="nv">62333</span><span class="p-Indicator">]]</span>
</code></pre></div>
<p>Inserts and updates are performed acorss the main and replicant datacentres.</p>

<p>If <code>mongodb_store_extras</code> is set (regardless of <code>replicate_on_write</code>), queries are performed on the main first, and if nothing found, the replicants are tried.</p>

<p>You can launch additional datacentres as follows, e.g.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rosrun mongodb_store mongodb_server.py _master:<span class="o">=</span><span class="nb">false </span>_database_path:<span class="o">=</span>/opt/strands/strands_mongodb_62344 _host:<span class="o">=</span>localhost _port:<span class="o">=</span>62344
rosrun mongodb_store mongodb_server.py _master:<span class="o">=</span><span class="nb">false </span>_database_path:<span class="o">=</span>/opt/strands/strands_mongodb_62333 _host:<span class="o">=</span>localhost _port:<span class="o">=</span>62333
</code></pre></div>
<p>You can test if this works by adding some things to the message store, deleting them from the master using RoboMongo (not the message store as the deletes are replicated), then running queries.</p>

<h2>Action Server for Replication</h2>

<p>The <code>MoveEntries</code> action and the corresponding action server:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rosrun mongodb_store replicator_node.py 
</code></pre></div>
<p>(which is included in <code>datacentre.launch</code>)</p>

<p>allows you to bulk copy or move entries from message store collections to the mongod instances defined under <code>mongodb_store_extras</code>. The client accepts a list of collection names and uses the <code>meta["inserted_at"]</code> field of the message store entries to replicate or move all entries that were inserted before a particular time. If no time is provided then the default is 24 hours ago. There is an example client that does this for a list of collections specified on the command line. This <em>moves</em> entries inserted 24 hours ago or earlier.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rosrun mongodb_store replicator_client.py message_store robblog scheduling_problems
</code></pre></div>
<p><strong>NOTE THAT this all makes <code>update</code> operations a bit uncertain, so please do not use this type of replication on collections you plan to use update on.</strong></p>
</div></body></html>

            </div>
          </div>
        
      </div>
    
      <div class="distro distro-groovy">
        
        <em>No branch for distro <strong>groovy</strong>. Known supported distros are highlighted in the buttons above.</em>
        
      </div>
    
      <div class="distro distro-fuerte">
        
        <em>No branch for distro <strong>fuerte</strong>. Known supported distros are highlighted in the buttons above.</em>
        
      </div>
    
      <div class="distro distro-electric">
        
        <em>No branch for distro <strong>electric</strong>. Known supported distros are highlighted in the buttons above.</em>
        
      </div>
    
      <div class="distro distro-diamondback">
        
        <em>No branch for distro <strong>diamondback</strong>. Known supported distros are highlighted in the buttons above.</em>
        
      </div>
    
      <div class="distro distro-c-turtle">
        
        <em>No branch for distro <strong>c-turtle</strong>. Known supported distros are highlighted in the buttons above.</em>
        
      </div>
    
  </div>
</div>

<script src="/js/distro_switch.js"></script>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>ROS Index</li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/rosindex">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">rosindex</span>
            </a>
          </li>
          

        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">A community-maintained index of known ROS packages.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
