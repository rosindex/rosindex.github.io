<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    <link rel="canonical" href="http://rosindex.github.io/r/pr2_delivery/">
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    <script type="text/javascript" src="/js/jquery.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/js/jquery-cookie-1.4.1/jquery.cookie.js" type="text/javascript"></script>

    <script type="text/javascript" src="/js/ga.js" async></script>
    <script type="text/javascript" src="/js/toc.js"></script>

    <!-- Pre-fetch search index files -->
    
    
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">


        <div class="col-sm-12 col-md-9" style="margin-top: 8px">
          <div class="row">
            <!-- title -->
            <div class="col-xs-12 col-sm-3 col-md-3" style="white-space:nowrap;">
              <a class="site-title" href="/">ROS Index</a> <sup><a href="https://github.com/rosindex/rosindex/issues/new" style="vertical-align:super;" class="label label-warning" target="_blank">BETA</a></sup>
            </div>

            <!-- main links -->
            <div class="col-xs-12 col-sm-9 col-md-9 text-right">
              <ul class="list-inline" style="margin-bottom:0px;">
                <li><a class="btn btn-link" href="/about">About</a></li>

                <li class="dropdown">
                  <button id="dLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Index <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                    <li><a href="/packages/page/1/time/">Package List</a></li>
                    <li><a href="/repos/page/1/time/">Repository List</a></li>

                    <li class="divider"></li>

                    <li class="disabled"><a href="/srvs/">Nodes</a></li>
                    <li class="disabled"><a href="/msgs/">Messages</a></li>
                    <li class="disabled"><a href="/srvs/">Services</a></li>
                    <li class="disabled"><a href="/srvs/">Plugins</a></li>

                    <li class="divider"></li>

                    <li><a href="/deps/">System Dependencies</a></li>
                  </ul>
                </li>

                <li class="dropdown disabled">
                  <button id="dLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Doc <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                    <li class="disabled"><a href="/categories/">Categories</a></li>
                    <li class="disabled"><a href="/tutorials">Tutorials</a></li>
                    <li class="disabled"><a href="/readmes">Readmes</a></li>
                    <li class="disabled"><a href="/apis">APIs</a></li>
                  </ul>
                </li>

                <li><a class="btn btn-link" href="/contribute">Contribute</a></li>
                <li><a class="btn btn-link" href="/stats">Stats</a></li>
              </ul>

            </div>
          </div>
        </div>

        <!-- searchbox -->
        <div class="col-sm-12 col-md-3" style="margin-top: 12px">
          <form action="/search/" role="form">
            <div class="input-group input-group-sm">
              <input type="text" class="form-control" name="q" placeholder="Search">
              <span class="input-group-btn">
                <button class="btn btn-default btn-sm" type="submit"><span class="glyphicon glyphicon-search"></span></button>
              </span>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!--
    <a class="site-title" href="/">ROS Index</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        <a class="page-link" href="/packages">Packages</a>
        <a class="page-link" href="/repos">Repositories</a>
        <a class="page-link" href="/search">Search</a>
      </div>
    </nav>
    -->

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">pr2_delivery</li>
        <!--<li class="active">pr2_delivery</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="kinetic-option" class="distro-button btn btn-xs btn-default" href="#kinetic" data="kinetic">
      <input type="radio" name="options" id="kinetic-radio" autocomplete="off"> kinetic
    </label>
  
    <label id="jade-option" class="distro-button btn btn-xs btn-default" href="#jade" data="jade">
      <input type="radio" name="options" id="jade-radio" autocomplete="off"> jade
    </label>
  
    <label id="indigo-option" class="distro-button btn btn-xs btn-primary" href="#indigo" data="indigo">
      <input type="radio" name="options" id="indigo-radio" autocomplete="off"> indigo
    </label>
  
    <label id="hydro-option" class="distro-button btn btn-xs btn-primary" href="#hydro" data="hydro">
      <input type="radio" name="options" id="hydro-radio" autocomplete="off"> hydro
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-primary" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="groovy" id="groovy-option" class=" older-distro-option"  href="#groovy">
          <a href="#groovy" data="groovy" id="groovy-button">groovy</a>
        </li>
      
        <li data="fuerte" id="fuerte-option" class="disabled older-distro-option"  href="#fuerte">
          <a href="#fuerte" data="fuerte" id="fuerte-button">fuerte</a>
        </li>
      
        <li data="electric" id="electric-option" class="disabled older-distro-option"  href="#electric">
          <a href="#electric" data="electric" id="electric-button">electric</a>
        </li>
      
        <li data="diamondback" id="diamondback-option" class="disabled older-distro-option"  href="#diamondback">
          <a href="#diamondback" data="diamondback" id="diamondback-button">diamondback</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
    <div class="row">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/pr2_delivery">pr2_delivery</a> <small>repository</small></h3>
        
      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 50px">
          <a type="button" class="btn btn-xs btn-default" data-toggle="tooltip" data-placement="left" title="View Instances" 
            href="/repos/pr2_delivery"><span class="glyphicon glyphicon-th"></span></a>
        </div>
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-pr2-pr2_delivery
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-pr2-pr2_delivery" role="menuitem" tabindex="-1" href="/r/pr2_delivery/github-pr2-pr2_delivery" data="github-pr2-pr2_delivery">
                    <span class="glyphicon glyphicon-star"></span>
                    github-pr2-pr2_delivery
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

    </div>
  </div>
</div>


  <div class="distro distro-kinetic">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>kinetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-jade">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>jade</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-indigo">
    <div class="container-fluid">
      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            

  <table class="table table-condensed">
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/pr2/pr2_delivery.git">https://github.com/pr2/pr2_delivery.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">hydro-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2015-02-06
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/pr2_delivery/github-pr2-pr2_delivery">pr2_delivery</a></td>
                    <td>1.0.6</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="rendered-markdown">
<h1 id="pr2_delivery">pr2_delivery</h1>

<p>This is a quick package put together to demonstrate a simple delivery task with the PR2.</p>

<p>It is written as an "action" server.</p>

<p>One run through the action does:</p>

<ul>
<li>Navigate to the get-object pose</li>
<li>Put the right arm out and open the gripper</li>
<li>Wait for something to be put in the gripper (wait for gripper-wiggle)</li>
<li>Close gripper</li>
<li>If gripper closes too far, open again and repeat waiting for object</li>
<li>Tuck arms to a tucked-with-object pose</li>
<li>Navigate to the give-object pose</li>
<li>Put the right arm out to hand off the object</li>
<li>Wait for gripper-wiggle</li>
<li>Open gripper</li>
<li>Tuck arms to regular tuck</li>
<li>Navigate to "home" pose</li>
</ul>

<p>This sequence is defined in src/pr2_delivery/DeliverServer.py.</p>

<h2 id="programs">Programs</h2>

<ul>
<li><p><strong>scripts/deliver</strong>: Runs the DeliverServer action server.</p></li>
<li>
<p><strong>test/test.py</strong>: sends an action goal asking it to make a delivery.</p>

<ul>
<li>The action goal contains the 3 poses: get-object, give-object, and home.</li>
<li><em>This is a file you will need to copy and modify for use in a new place.</em></li>
</ul>
</li>
<li><p><strong>scripts/print_right_arm_pose</strong>: repeatedly prints the pose of the right arm in the same order that is used inside DeliveryServer.py.  Use this with (or without) the run-stop pressed to record new arm poses if you need to.</p></li>
<li><p><strong>test/watch_robot_base_pose.sh</strong>: repeatedly prints the pose of the robot base.  This can be convenient for recording new poses for get-object, give-object, and home.</p></li>
</ul>

<h2 id="launch-files">Launch files</h2>

<ul>
<li>
<p><strong>launch/deliver_server.launch</strong>: runs scripts/deliver and a bunch of support nodes which it depends on.</p>

<ul>
<li>Does <em>not</em> run map_server.</li>
</ul>
</li>
<li>
<p><strong>launch/deliver_server_wg.launch</strong>: runs deliver_server.launch and map_server with a map of Willow Garage.</p>

<ul>
<li><em>This is a file you will need to copy and modify for use in a new place.</em></li>
</ul>
</li>
</ul>

<h2 id="instructions-for-use">Instructions for use</h2>

<h3 id="initial-setup">Initial Setup</h3>

<ul>
<li>Clone this package (pr2_delivery) into your rosbuild workspace.</li>
<li>rosmake pr2_delivery # to build action/message files.</li>
<li>Map the environment</li>
<li>Copy launch/deliver_server_wg.launch to launch/deliver_server_location_name.launch and fill in the map info for the map you just made.</li>
<li>Record poses of the robot base to use for home, get-object, and give-object using test/watch_robot_base_pose.sh and either navigation using rviz or joystick teleop.</li>
<li>Copy test/test.py into scripts/do-one-delivery.py or similar and copy the base-pose info into it (x, y, yaw).</li>
</ul>

<h3 id="starting-the-action-server">Starting the Action Server</h3>

<ul>
<li>roslaunch /etc/ros/robot.launch # to bring up the robot</li>
<li>roslaunch pr2_delivery deliver_server_location_name.launch</li>
<li><em>Robot should not immediately do anything</em></li>
</ul>

<h3 id="making-a-delivery">Making a Delivery</h3>

<ul>
<li>rosrun pr2_delivery scripts/do-one-delivery.py</li>
<li><em>Robot will tuck arms and navigate to get-object location.</em></li>
<li><em>After delivery is done it will tuck arms and drive to home location.</em></li>
</ul>

<h2 id="problems-that-may-happen">Problems that may happen</h2>

<h3 id="hallucinated-obstacles">Hallucinated obstacles</h3>

<p>The main problem I've had is the tilting laser hitting the
object-being-carried, which causes hallucinations of obstacles about
30 cm in front of the robot.  You should always keep a GridCells
display in RViz showing the local costmap obstacles so you can see if
this is happening.  It's also useful to show a pointcloud of
/tilt_scan_shadow_filtered with Decay Time set to 3 seconds or so.
That is what has the tilt laser data right after the filter.</p>

<p>To fix a problem like this, either modify the tucked_with_object_pose
in DeliverServer.py OR modify the parameters of downscan_filter in
launch/pr2_delivery_nav/tilt_laser_filters.yaml to make it ignore more
of the lower section of the tilt scan data.</p>

<p>The other important thing is that the current numbers have been tuned
for the storage clipboard.  If you use a different object that is
larger, it may trigger this again and need re-tuning.</p>

<h3 id="navigating-after-arm-being-out">Navigating after arm being out</h3>

<p>I haven't seen this particularly, but when the arm is out to give or
get, the nav stack will think there are obstacles close to the robot
in front.  When the arms tuck, there is some chance that some obstacle
cells in the costmap won't be cleared immediately and the robot will
try to navigate around them.</p>

<p>This can likely be solved by arranging the pick-up and drop-off poses
such that the robot generally turns around to go to the next pose,
instead of needing to drive straight ahead after getting or giving the
object.</p>

<h3 id="gripper-cycling">Gripper Cycling</h3>

<p>There have been a few times where the gripper sensor nodes don't
launch properly.  When that happens, the robot always thinks its hand
is being shaken.  So when it is waiting for an object to be given, it
constantly closes the hand and re-opens it.  If you give it something
in that state, it is bad because when it is time to <em>give</em> the object,
it will think someone is pulling on it immediately and thus open the
gripper and drop the object on the floor.</p>

<p>The solution (that I know of) is to re-launch the deliver action
server.  It hasn't happened twice in a row, so this is all I've done
to solve it so far.</p>

<h3 id="joystick-teleop-broken">Joystick Teleop Broken</h3>

<p>I haven't looked into this, but joystick teleop seems to not work when
this is running.  Maybe a mux issue?</p>
</div></body></html>

            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-hydro">
    <div class="container-fluid">
      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            

  <table class="table table-condensed">
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/pr2/pr2_delivery.git">https://github.com/pr2/pr2_delivery.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">hydro-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2015-02-06
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-default">UNRELEASED
        </span>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/pr2_delivery/github-pr2-pr2_delivery">pr2_delivery</a></td>
                    <td>1.0.6</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="rendered-markdown">
<h1 id="pr2_delivery">pr2_delivery</h1>

<p>This is a quick package put together to demonstrate a simple delivery task with the PR2.</p>

<p>It is written as an "action" server.</p>

<p>One run through the action does:</p>

<ul>
<li>Navigate to the get-object pose</li>
<li>Put the right arm out and open the gripper</li>
<li>Wait for something to be put in the gripper (wait for gripper-wiggle)</li>
<li>Close gripper</li>
<li>If gripper closes too far, open again and repeat waiting for object</li>
<li>Tuck arms to a tucked-with-object pose</li>
<li>Navigate to the give-object pose</li>
<li>Put the right arm out to hand off the object</li>
<li>Wait for gripper-wiggle</li>
<li>Open gripper</li>
<li>Tuck arms to regular tuck</li>
<li>Navigate to "home" pose</li>
</ul>

<p>This sequence is defined in src/pr2_delivery/DeliverServer.py.</p>

<h2 id="programs">Programs</h2>

<ul>
<li><p><strong>scripts/deliver</strong>: Runs the DeliverServer action server.</p></li>
<li>
<p><strong>test/test.py</strong>: sends an action goal asking it to make a delivery.</p>

<ul>
<li>The action goal contains the 3 poses: get-object, give-object, and home.</li>
<li><em>This is a file you will need to copy and modify for use in a new place.</em></li>
</ul>
</li>
<li><p><strong>scripts/print_right_arm_pose</strong>: repeatedly prints the pose of the right arm in the same order that is used inside DeliveryServer.py.  Use this with (or without) the run-stop pressed to record new arm poses if you need to.</p></li>
<li><p><strong>test/watch_robot_base_pose.sh</strong>: repeatedly prints the pose of the robot base.  This can be convenient for recording new poses for get-object, give-object, and home.</p></li>
</ul>

<h2 id="launch-files">Launch files</h2>

<ul>
<li>
<p><strong>launch/deliver_server.launch</strong>: runs scripts/deliver and a bunch of support nodes which it depends on.</p>

<ul>
<li>Does <em>not</em> run map_server.</li>
</ul>
</li>
<li>
<p><strong>launch/deliver_server_wg.launch</strong>: runs deliver_server.launch and map_server with a map of Willow Garage.</p>

<ul>
<li><em>This is a file you will need to copy and modify for use in a new place.</em></li>
</ul>
</li>
</ul>

<h2 id="instructions-for-use">Instructions for use</h2>

<h3 id="initial-setup">Initial Setup</h3>

<ul>
<li>Clone this package (pr2_delivery) into your rosbuild workspace.</li>
<li>rosmake pr2_delivery # to build action/message files.</li>
<li>Map the environment</li>
<li>Copy launch/deliver_server_wg.launch to launch/deliver_server_location_name.launch and fill in the map info for the map you just made.</li>
<li>Record poses of the robot base to use for home, get-object, and give-object using test/watch_robot_base_pose.sh and either navigation using rviz or joystick teleop.</li>
<li>Copy test/test.py into scripts/do-one-delivery.py or similar and copy the base-pose info into it (x, y, yaw).</li>
</ul>

<h3 id="starting-the-action-server">Starting the Action Server</h3>

<ul>
<li>roslaunch /etc/ros/robot.launch # to bring up the robot</li>
<li>roslaunch pr2_delivery deliver_server_location_name.launch</li>
<li><em>Robot should not immediately do anything</em></li>
</ul>

<h3 id="making-a-delivery">Making a Delivery</h3>

<ul>
<li>rosrun pr2_delivery scripts/do-one-delivery.py</li>
<li><em>Robot will tuck arms and navigate to get-object location.</em></li>
<li><em>After delivery is done it will tuck arms and drive to home location.</em></li>
</ul>

<h2 id="problems-that-may-happen">Problems that may happen</h2>

<h3 id="hallucinated-obstacles">Hallucinated obstacles</h3>

<p>The main problem I've had is the tilting laser hitting the
object-being-carried, which causes hallucinations of obstacles about
30 cm in front of the robot.  You should always keep a GridCells
display in RViz showing the local costmap obstacles so you can see if
this is happening.  It's also useful to show a pointcloud of
/tilt_scan_shadow_filtered with Decay Time set to 3 seconds or so.
That is what has the tilt laser data right after the filter.</p>

<p>To fix a problem like this, either modify the tucked_with_object_pose
in DeliverServer.py OR modify the parameters of downscan_filter in
launch/pr2_delivery_nav/tilt_laser_filters.yaml to make it ignore more
of the lower section of the tilt scan data.</p>

<p>The other important thing is that the current numbers have been tuned
for the storage clipboard.  If you use a different object that is
larger, it may trigger this again and need re-tuning.</p>

<h3 id="navigating-after-arm-being-out">Navigating after arm being out</h3>

<p>I haven't seen this particularly, but when the arm is out to give or
get, the nav stack will think there are obstacles close to the robot
in front.  When the arms tuck, there is some chance that some obstacle
cells in the costmap won't be cleared immediately and the robot will
try to navigate around them.</p>

<p>This can likely be solved by arranging the pick-up and drop-off poses
such that the robot generally turns around to go to the next pose,
instead of needing to drive straight ahead after getting or giving the
object.</p>

<h3 id="gripper-cycling">Gripper Cycling</h3>

<p>There have been a few times where the gripper sensor nodes don't
launch properly.  When that happens, the robot always thinks its hand
is being shaken.  So when it is waiting for an object to be given, it
constantly closes the hand and re-opens it.  If you give it something
in that state, it is bad because when it is time to <em>give</em> the object,
it will think someone is pulling on it immediately and thus open the
gripper and drop the object on the floor.</p>

<p>The solution (that I know of) is to re-launch the deliver action
server.  It hasn't happened twice in a row, so this is all I've done
to solve it so far.</p>

<h3 id="joystick-teleop-broken">Joystick Teleop Broken</h3>

<p>I haven't looked into this, but joystick teleop seems to not work when
this is running.  Maybe a mux issue?</p>
</div></body></html>

            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-groovy">
    <div class="container-fluid">
      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            

  <table class="table table-condensed">
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/pr2/pr2_delivery.git">https://github.com/pr2/pr2_delivery.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">groovy-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2013-09-15
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-default">UNRELEASED
        </span>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/pr2_delivery/github-pr2-pr2_delivery">pr2_delivery</a></td>
                    <td>UNKNOWN</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="rendered-markdown">
<h1 id="pr2_delivery">pr2_delivery</h1>

<p>This is a quick package put together to demonstrate a simple delivery task with the PR2.</p>

<p>It is written as an "action" server.</p>

<p>One run through the action does:</p>

<ul>
<li>Navigate to the get-object pose</li>
<li>Put the right arm out and open the gripper</li>
<li>Wait for something to be put in the gripper (wait for gripper-wiggle)</li>
<li>Close gripper</li>
<li>If gripper closes too far, open again and repeat waiting for object</li>
<li>Tuck arms to a tucked-with-object pose</li>
<li>Navigate to the give-object pose</li>
<li>Put the right arm out to hand off the object</li>
<li>Wait for gripper-wiggle</li>
<li>Open gripper</li>
<li>Tuck arms to regular tuck</li>
<li>Navigate to "home" pose</li>
</ul>

<p>This sequence is defined in src/pr2_delivery/DeliverServer.py.</p>

<h2 id="programs">Programs</h2>

<ul>
<li><p><strong>scripts/deliver</strong>: Runs the DeliverServer action server.</p></li>
<li>
<p><strong>test/test.py</strong>: sends an action goal asking it to make a delivery.</p>

<ul>
<li>The action goal contains the 3 poses: get-object, give-object, and home.</li>
<li><em>This is a file you will need to copy and modify for use in a new place.</em></li>
</ul>
</li>
<li><p><strong>scripts/print_right_arm_pose</strong>: repeatedly prints the pose of the right arm in the same order that is used inside DeliveryServer.py.  Use this with (or without) the run-stop pressed to record new arm poses if you need to.</p></li>
<li><p><strong>test/watch_robot_base_pose.sh</strong>: repeatedly prints the pose of the robot base.  This can be convenient for recording new poses for get-object, give-object, and home.</p></li>
</ul>

<h2 id="launch-files">Launch files</h2>

<ul>
<li>
<p><strong>launch/deliver_server.launch</strong>: runs scripts/deliver and a bunch of support nodes which it depends on.</p>

<ul>
<li>Does <em>not</em> run map_server.</li>
</ul>
</li>
<li>
<p><strong>launch/deliver_server_wg.launch</strong>: runs deliver_server.launch and map_server with a map of Willow Garage.</p>

<ul>
<li><em>This is a file you will need to copy and modify for use in a new place.</em></li>
</ul>
</li>
</ul>

<h2 id="instructions-for-use">Instructions for use</h2>

<h3 id="initial-setup">Initial Setup</h3>

<ul>
<li>Clone this package (pr2_delivery) into your rosbuild workspace.</li>
<li>rosmake pr2_delivery # to build action/message files.</li>
<li>Map the environment</li>
<li>Copy launch/deliver_server_wg.launch to launch/deliver_server_location_name.launch and fill in the map info for the map you just made.</li>
<li>Record poses of the robot base to use for home, get-object, and give-object using test/watch_robot_base_pose.sh and either navigation using rviz or joystick teleop.</li>
<li>Copy test/test.py into scripts/do-one-delivery.py or similar and copy the base-pose info into it (x, y, yaw).</li>
</ul>

<h3 id="starting-the-action-server">Starting the Action Server</h3>

<ul>
<li>roslaunch /etc/ros/robot.launch # to bring up the robot</li>
<li>roslaunch pr2_delivery deliver_server_location_name.launch</li>
<li><em>Robot should not immediately do anything</em></li>
</ul>

<h3 id="making-a-delivery">Making a Delivery</h3>

<ul>
<li>rosrun pr2_delivery scripts/do-one-delivery.py</li>
<li><em>Robot will tuck arms and navigate to get-object location.</em></li>
<li><em>After delivery is done it will tuck arms and drive to home location.</em></li>
</ul>

<h2 id="problems-that-may-happen">Problems that may happen</h2>

<h3 id="hallucinated-obstacles">Hallucinated obstacles</h3>

<p>The main problem I've had is the tilting laser hitting the
object-being-carried, which causes hallucinations of obstacles about
30 cm in front of the robot.  You should always keep a GridCells
display in RViz showing the local costmap obstacles so you can see if
this is happening.  It's also useful to show a pointcloud of
/tilt_scan_shadow_filtered with Decay Time set to 3 seconds or so.
That is what has the tilt laser data right after the filter.</p>

<p>To fix a problem like this, either modify the tucked_with_object_pose
in DeliverServer.py OR modify the parameters of downscan_filter in
launch/pr2_delivery_nav/tilt_laser_filters.yaml to make it ignore more
of the lower section of the tilt scan data.</p>

<p>The other important thing is that the current numbers have been tuned
for the storage clipboard.  If you use a different object that is
larger, it may trigger this again and need re-tuning.</p>

<h3 id="navigating-after-arm-being-out">Navigating after arm being out</h3>

<p>I haven't seen this particularly, but when the arm is out to give or
get, the nav stack will think there are obstacles close to the robot
in front.  When the arms tuck, there is some chance that some obstacle
cells in the costmap won't be cleared immediately and the robot will
try to navigate around them.</p>

<p>This can likely be solved by arranging the pick-up and drop-off poses
such that the robot generally turns around to go to the next pose,
instead of needing to drive straight ahead after getting or giving the
object.</p>

<h3 id="gripper-cycling">Gripper Cycling</h3>

<p>There have been a few times where the gripper sensor nodes don't
launch properly.  When that happens, the robot always thinks its hand
is being shaken.  So when it is waiting for an object to be given, it
constantly closes the hand and re-opens it.  If you give it something
in that state, it is bad because when it is time to <em>give</em> the object,
it will think someone is pulling on it immediately and thus open the
gripper and drop the object on the floor.</p>

<p>The solution (that I know of) is to re-launch the deliver action
server.  It hasn't happened twice in a row, so this is all I've done
to solve it so far.</p>

<h3 id="joystick-teleop-broken">Joystick Teleop Broken</h3>

<p>I haven't looked into this, but joystick teleop seems to not work when
this is running.  Maybe a mux issue?</p>
</div></body></html>

            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-fuerte">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>fuerte</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-electric">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>electric</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-diamondback">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>diamondback</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>


<script src="/js/distro_switch.js"></script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-4 col-md-4">
          
            <a href="https://github.com/rosindex">
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>

            <span class="username">rosindex</span>
          </a>
          |
          <em>generated on 2016-07-04</em>
        
        </div>
        <div class="col-sm-8 col-md-8 text-right">
          <p class="text">a community-maintained index of robotics software
 | <a href="/privacy.txt">privacy</a></p>
        </div>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
