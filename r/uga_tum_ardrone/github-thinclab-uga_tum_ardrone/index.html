<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    <link rel="canonical" href="http://rosindex.github.io/r/uga_tum_ardrone/github-thinclab-uga_tum_ardrone/">
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    <script type="text/javascript" src="/js/jquery.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/js/jquery-cookie-1.4.1/jquery.cookie.js" type="text/javascript"></script>

    <script type="text/javascript" src="/js/ga.js" async></script>
    <script type="text/javascript" src="/js/toc.js"></script>

    <!-- Pre-fetch search index files -->
    
    
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">


        <div class="col-sm-12 col-md-9" style="margin-top: 8px">
          <div class="row">
            <!-- title -->
            <div class="col-xs-12 col-sm-3 col-md-3" style="white-space:nowrap;">
              <a class="site-title" href="/">ROS Index</a> <sup><a href="https://github.com/rosindex/rosindex/issues/new" style="vertical-align:super;" class="label label-warning" target="_blank">BETA</a></sup>
            </div>

            <!-- main links -->
            <div class="col-xs-12 col-sm-9 col-md-9 text-right">
              <ul class="list-inline" style="margin-bottom:0px;">
                <li><a class="btn btn-link" href="/about">About</a></li>

                <li class="dropdown">
                  <button id="dLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Index <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                    <li><a href="/packages/page/1/time/">Package List</a></li>
                    <li><a href="/repos/page/1/time/">Repository List</a></li>

                    <li class="divider"></li>

                    <li class="disabled"><a href="/srvs/">Nodes</a></li>
                    <li class="disabled"><a href="/msgs/">Messages</a></li>
                    <li class="disabled"><a href="/srvs/">Services</a></li>
                    <li class="disabled"><a href="/srvs/">Plugins</a></li>

                    <li class="divider"></li>

                    <li><a href="/deps/">System Dependencies</a></li>
                  </ul>
                </li>

                <li class="dropdown disabled">
                  <button id="dLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Doc <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                    <li class="disabled"><a href="/categories/">Categories</a></li>
                    <li class="disabled"><a href="/tutorials">Tutorials</a></li>
                    <li class="disabled"><a href="/readmes">Readmes</a></li>
                    <li class="disabled"><a href="/apis">APIs</a></li>
                  </ul>
                </li>

                <li><a class="btn btn-link" href="/contribute">Contribute</a></li>
                <li><a class="btn btn-link" href="/stats">Stats</a></li>
              </ul>

            </div>
          </div>
        </div>

        <!-- searchbox -->
        <div class="col-sm-12 col-md-3" style="margin-top: 12px">
          <form action="/search/" role="form">
            <div class="input-group input-group-sm">
              <input type="text" class="form-control" name="q" placeholder="Search">
              <span class="input-group-btn">
                <button class="btn btn-default btn-sm" type="submit"><span class="glyphicon glyphicon-search"></span></button>
              </span>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!--
    <a class="site-title" href="/">ROS Index</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        <a class="page-link" href="/packages">Packages</a>
        <a class="page-link" href="/repos">Repositories</a>
        <a class="page-link" href="/search">Search</a>
      </div>
    </nav>
    -->

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">uga_tum_ardrone</li>
        <!--<li class="active">uga_tum_ardrone</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="kinetic-option" class="distro-button btn btn-xs btn-default" href="#kinetic" data="kinetic">
      <input type="radio" name="options" id="kinetic-radio" autocomplete="off"> kinetic
    </label>
  
    <label id="jade-option" class="distro-button btn btn-xs btn-default" href="#jade" data="jade">
      <input type="radio" name="options" id="jade-radio" autocomplete="off"> jade
    </label>
  
    <label id="indigo-option" class="distro-button btn btn-xs btn-primary" href="#indigo" data="indigo">
      <input type="radio" name="options" id="indigo-radio" autocomplete="off"> indigo
    </label>
  
    <label id="hydro-option" class="distro-button btn btn-xs btn-primary" href="#hydro" data="hydro">
      <input type="radio" name="options" id="hydro-radio" autocomplete="off"> hydro
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-primary" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="groovy" id="groovy-option" class=" older-distro-option"  href="#groovy">
          <a href="#groovy" data="groovy" id="groovy-button">groovy</a>
        </li>
      
        <li data="fuerte" id="fuerte-option" class=" older-distro-option"  href="#fuerte">
          <a href="#fuerte" data="fuerte" id="fuerte-button">fuerte</a>
        </li>
      
        <li data="electric" id="electric-option" class="disabled older-distro-option"  href="#electric">
          <a href="#electric" data="electric" id="electric-button">electric</a>
        </li>
      
        <li data="diamondback" id="diamondback-option" class="disabled older-distro-option"  href="#diamondback">
          <a href="#diamondback" data="diamondback" id="diamondback-button">diamondback</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
    <div class="row">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/uga_tum_ardrone">uga_tum_ardrone</a> <small>repository</small></h3>
        
      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 50px">
          <a type="button" class="btn btn-xs btn-default" data-toggle="tooltip" data-placement="left" title="View Instances" 
            href="/repos/uga_tum_ardrone"><span class="glyphicon glyphicon-th"></span></a>
        </div>
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-thinclab-uga_tum_ardrone
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-thinclab-uga_tum_ardrone" role="menuitem" tabindex="-1" href="/r/uga_tum_ardrone/github-thinclab-uga_tum_ardrone" data="github-thinclab-uga_tum_ardrone">
                    <span class="glyphicon glyphicon-star"></span>
                    github-thinclab-uga_tum_ardrone
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

    </div>
  </div>
</div>


  <div class="distro distro-kinetic">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>kinetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-jade">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>jade</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-indigo">
    <div class="container-fluid">
      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            

  <table class="table table-condensed">
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/thinclab/uga_tum_ardrone.git">https://github.com/thinclab/uga_tum_ardrone.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">indigo-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2015-12-12
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/uga_tum_ardrone/github-thinclab-uga_tum_ardrone">uga_tum_ardrone</a></td>
                    <td>0.0.2</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="rendered-markdown">
<h1 id="package-uga_tum_ardrone">Package uga_tum_ardrone</h1>

<p>This package is a fork of the popular <a href="https://github.com/tum-vision/tum_ardrone">tum_ardrone</a> package. Currently, the changes are:</p>

<ul>
<li>Replace the PID controller with a more specialized controller based on a damped spring</li>
<li>Improve the accuracy of the state estimation </li>
<li>Small bug fixes and improvements to the user experience</li>
</ul>

<p>This package contains the implementation corresponding to the following publications:</p>

<ul>
<li>
<a href="https://vision.in.tum.de/_media/spezial/bib/engel14ras.pdf">Scale-Aware Navigation of a Low-Cost Quadrocopter with a Monocular Camera</a> (J. Engel, J. Sturm, D. Cremers)</li>
<li>
<a href="https://vision.in.tum.de/_media/spezial/bib/engel12iros.pdf">Camera-Based Navigation of a Low-Cost Quadrocopter</a> (J. Engel, J. Sturm, D. Cremers)</li>
<li>
<a href="https://vision.in.tum.de/_media/spezial/bib/engel12vicomor.pdf">Accurate Figure Flying with a Quadrocopter Using Onboard Visual and Inertial Sensing</a> (J. Engel, J. Sturm, D. Cremers) </li>
</ul>

<p>You can find a <a href="https://www.youtube.com/watch?feature=player_embedded&amp;v=eznMokFQmpc">video</a> on <em>youtube</em>.
This Package builds on the well known monocular SLAM framework PTAM presented by Klein &amp; Murray in their paper at ISMAR07. Please study the original PTAM website and the corresponding paper for more information on this part of the software. Also, be aware of the license that comes with it. </p>

<p>The code works for both the AR.Drone 1.0 and 2.0, the default-parameters however are optimized for the AR.Drone 2.0 by now.</p>

<h2 id="installation">Installation</h2>

<h3 id="with-catkin">with catkin</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd </span>catkin_ws/src
git clone https://github.com/thinclab/uga_tum_ardrone.git -b indigo-devel
<span class="nb">cd</span> ..
rosdep install uga_tum_ardrone
catkin_make

</code></pre></div>
<h2 id="quick-start">Quick start</h2>

<h4 id="launch-the-nodes">Launch the nodes</h4>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">roslaunch uga_tum_ardrone ardrone_driver.launch
roslaunch uga_tum_ardrone uga_tum_ardrone.launch

</code></pre></div>
<h4 id="check-status">Check status</h4>

<p>On the GUI, under Drone Communication Status, you should see:
- Drone Navdata: XHz (X &gt; 100)
- Pose Estimates: 33Hz</p>

<h4 id="keyboard-control">Keyboard control</h4>

<ul>
<li>focus drone_gui window</li>
<li>press ESC to activate KB control</li>
<li>fly around with KB (see <a href="#drone_gui">drone_gui</a> for key assignments)</li>
</ul>

<h4 id="joystick-control">Joystick control</h4>

<ul>
<li>rosrun joy joy_node</li>
<li>press PS button on controller to activate it</li>
<li>fly around (see <a href="#drone_gui">drone_gui</a> for key assignments)</li>
</ul>

<h4 id="autopilot">Autopilot</h4>

<ul>
<li>type command "autoInit 500 800" in top-left text-field</li>
<li>click Clear and Send (maybe click Reset first)
=&gt; drone will takeoff &amp; init PTAM, then hold position.</li>
<li>click on video to interactively set target (relative to current position); see <a href="#drone_stateestimation">drone_stateestimation</a>
=&gt; first fly up 1m and then down 1m to facilitate a good scale estimate, dont start e.g. by flying horizontally over uneven terrain (!).</li>
<li>always have a finger on ESC or on the joystick for emergency-keyboard control :)</li>
</ul>

<h2 id="nodes">Nodes</h2>

<h3 id="drone_stateestimation">drone_stateestimation</h3>

<p>Estimates the drone's position based on sent navdata, sent control commands and PTAM.</p>

<blockquote>
<p>IMPORTANT: requires messages to be sent on both /ardrone/navdata (&gt;100Hz) and /ardrone/image_raw (&gt;10Hz), i.e. a connected drone with running ardrone_autonomy node, or a .bag replay of at least those two channels. ardrone_autonomy should be started with:</p>
</blockquote>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rosrun ardrone_autonomy ardrone_driver _navdata_demo:<span class="o">=</span>0 _loop_rate:<span class="o">=</span>500

</code></pre></div>
<h4 id="subscribed-topics"> Subscribed topics</h4>

<ul>
<li>/ardrone/navdata</li>
<li>/ardrone/image_raw</li>
<li>/cmd_vel</li>
<li>/uga_tum_ardrone/com</li>
</ul>

<h4 id="published-topics">Published topics</h4>

<ul>
<li>/ardrone/predictedPose</li>
<li>/uga_tum_ardrone/com</li>
</ul>

<h4 id="services">Services</h4>

<p>None</p>

<h4 id="parameters"> Parameters</h4>

<ul>
<li>~publishFreq: frequency, at which the drone's estimated position is calculated &amp; published. Default: 30Hz</li>
<li>~calibFile: camera calibration file. If not set, the defaults are used (camcalib/ardroneX_default.txt).</li>
<li>UseControlGains: whether to use control gains for EKF prediction.</li>
<li>UsePTAM: whether to use PTAM pose estimates as EKF update</li>
<li>
<p>UseNavdata: whether to use Navdata information for EKF update</p>

<blockquote>
<p>UsePTAM and UseNavdata are set to false, the EKF is never updated and acts as a pure simulator, prediciting the pose based on the control commands received (on /cmd_vel). Nice for experimenting.</p>
</blockquote>
</li>
<li><p>PTAMMapLock: lock PTAM map (no more KF)</p></li>
<li><p>PTAMSyncLock: lock PTAM map sync (fix scale and pose offsets etc.)</p></li>
<li><p>PTAMMaxKF: maximum amount of KF PTAM takes. </p></li>
<li><p>PTAMMinKFDist: min. distance between two KF (in meters)</p></li>
<li><p>PTAMMinKFWiggleDist: min. distance between two KF (relative to mean scene depth).</p></li>
<li>
<p>PTAMMinKFTimeDiff: min time between two KF.</p>

<blockquote>
<p>PTAM takes a new KF if (PTAMMinKFTimeDiff AND (PTAMMinKFDist OR PTAMMinKFWiggleDist)), and tracking is good etc.</p>
</blockquote>
</li>
<li><p>RescaleFixOrigin: If the scale of the Map is reestimated, only one point in the mapping PTAM &lt;-&gt; World remains fixed.
If RescaleFixOrigin == false, this is the current pos. of the drone (to avoid sudden, large "jumps"). this however makes the map "drift".
If RescaleFixOrigin == true, by default this is the initialization point where the second KF has been taken (drone pos. may jump suddenly, but map remains fixed.). The fixpoint may be set by the command "lockScaleFP".</p></li>
<li><p>MinTolerance: min. scale to accept, prevents initialization failures that could cause the drone to crash (physically)</p></li>
<li><p>MaxTolerance: max. scale to accept, prevents initialization failures that could cause the drone to crash (physically)</p></li>
<li><p>c1 ... c8: prediction model parameters of the EKF. see "Camera-Based Navigation of a Low-Cost Quadrocopter"</p></li>
<li><p>zDriftThreshold: ignore changes in Z below this threshold when landed, prevents drifting when on the ground and tracking is lost</p></li>
<li><p>yawDriftThreshold: ingore changes in Yaw below this threshold when landed, prevents drifting when on the ground and tracking is lost</p></li>
</ul>

<h4 id="required-tf-transforms"> Required tf transforms</h4>

<p>TODO</p>

<h4 id="provided-tf-transforms"> Provided tf transforms</h4>

<p>TODO</p>

<h4 id="using-it">Using it</h4>

<p>To properly estimate PTAM's scale, it is best to fly up and down a little bit (e.g. 1m up and 1m down) immediately after initialization.
There are two windows, one shows the video and PTAM's map points, the other one the map. To issue key commands, focus the respective window and hit a key. This generates a command on /uga_tum_ardrone/com, which in turn is parsed and does something.</p>

<h6 id="video-window">Video Window</h6>

<p><img src="http://wiki.ros.org/tum_ardrone/drone_stateestimation?action=AttachFile&amp;do=get&amp;target=video.png" alt="Video window"></p>

<table>
<thead>
<tr>
<th>Key</th>
<th>/tum_adrone/com message</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>"p reset"</td>
<td>resets PTAM</td>
</tr>
<tr>
<td>u</td>
<td>"p toggleUI"</td>
<td>changes view</td>
</tr>
<tr>
<td>space</td>
<td>"p space"</td>
<td>takes first / second Keyframe for PTAM's initialization</td>
</tr>
<tr>
<td>k</td>
<td>"p keyframe"</td>
<td>forces PTAM to take a keyframe</td>
</tr>
<tr>
<td>l</td>
<td>"toggleLog"</td>
<td>starts / stops extensive logging of all kinds of values to a file</td>
</tr>
<tr>
<td>m</td>
<td>"p toggleLockMap"</td>
<td>locks map, equivalent to parameter PTAMMapLock</td>
</tr>
<tr>
<td>n</td>
<td>"p toggleLockSync"</td>
<td>locks sync, equivalent to parameter PTAMSyncLock</td>
</tr>
</tbody>
</table>

<p>Clicking on the video window will generate waypoints, which are sent to drone_autopilot (if running):
- left-click: fly (x,y,0)m relative to the current position. image-center is (0,0), borders are 2m respectively.
- right-click: fly (0,0,y)m and rotate yaw by x degree. image-center is (0,0), borders are 2m and 90 degree respectively.</p>

<h6 id="map-window">Map Window</h6>

<p><img src="http://wiki.ros.org/tum_ardrone/drone_stateestimation?action=AttachFile&amp;do=get&amp;target=map.png" alt="Map window"></p>

<table>
<thead>
<tr>
<th>Key</th>
<th>/tum_adrone/com message</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>"f reset"</td>
<td>resets EKF and PTAM</td>
</tr>
<tr>
<td>u</td>
<td>"m toggleUI"</td>
<td>changes view</td>
</tr>
<tr>
<td>v</td>
<td>"m resetView"</td>
<td>resets viewpoint of viewer</td>
</tr>
<tr>
<td>l</td>
<td>"toggleLog"</td>
<td>starts / stops extensive logging of all kinds of values to a file</td>
</tr>
<tr>
<td>v</td>
<td>"m clearTrail"</td>
<td>clears green drone-trail</td>
</tr>
</tbody>
</table>

<h3 id="drone_autopilot">drone_autopilot</h3>

<p>Critically damped spring based controller for the drone (see: <a href="https://en.wikipedia.org/wiki/Damping">Wikipedia: Damping</a> ). Also includes basic way-point-following and automatic initialization. Requires <a href="#drone_stateestimation">drone_stateestimation</a> to be running. The target is set via the /uga_tum_ardrone/com topic.</p>

<p>Two dimensions (Yaw and Z) can be controlled directly by the drone's motors.  The other two (X and Y) are controlled by the drone "leaning" in that direction, which complicates control slightly. 
The damped springs provide a target force that the drone tries to generate with its motors and leaning, while still maintaining it's altitude.</p>

<h4 id="subscribed-topics"> Subscribed topics</h4>

<ul>
<li>/ardrone/predictedPose</li>
</ul>

<h4 id="published-topics">Published topics</h4>

<ul>
<li>/cmd_vel</li>
<li>/ardrone/land</li>
<li>/ardrone/takeoff</li>
<li>/ardrone/reset</li>
</ul>

<h4 id="services">Services</h4>

<p>None</p>

<h4 id="parameters"> Parameters</h4>

<ul>
<li>~minPublishFreq: usually, a control command is sent for each pose estimate received from drone_stateestimation. However, if no pose estimate is received for more than minPublishFreq milliseconds, a HOVER command is sent, causing the drone to hover if for example drone_stateestimation is shut down suddenly. Default: 110.</li>
<li>K_direct, K_rp: spring strength of the directly controlled dimensions (yaw and Z) and the leaning dimensions (X and Y) respectively</li>
<li>droneMassInKilos: needed for proper damping</li>
<li>max_yaw: can be used to limit the speed of yaw'ing (the drone can spin quite fast!)</li>
<li>xy_damping_factor: due to the use of leaning the drone can only roughly approximate a damped spring, tune this parameter to account for things like air resistance and wind</li>
<li>max_rp_radians: this should match the corresponding parameter in ardrone_autonomy</li>
<li>max_gaz_rise: limit the maximum positive Z speed (m/s)</li>
<li>max_gaz_drop: limit the maximum negative Z speed (m/s)</li>
<li><p>max_rp: limit the maximum leaning command sent (x and y)</p></li>
<li><p>rise_fac: rise commands are larger than respective drop commands by this factor. This is due to the drone sometimes dropping unpredictably fast for large drop commands, however rising somethimes requires large rise commands.</p></li>
<li><p>aggressiveness: multiplied to PI-component of all commands sent. Low values lead to the drone flying "slower".</p></li>
</ul>

<h4 id="required-tf-transforms"> Required tf transforms</h4>

<p>TODO</p>

<h4 id="provided-tf-transforms"> Provided tf transforms</h4>

<p>TODO</p>

<h4 id="using-it">Using it</h4>

<p>The behavior of the autopilot is set by sending commands on /uga_tum_ardrone/com of the form "c COMMAND". A Queue of commands is kept, and as soon as one command is finished (for example a way point reached), the next command is popped. The queue can be cleared by sending "c clearCommands". Commands can be sent using the <a href="#drone_gui">drone_gui</a> node. Some example scripts can be found in /flightPlans/*.txt. Possible commands are:</p>

<ul>
<li>
<p>autoInit [int moveTimeMS] [int waitTimeMS] [int riseTimeMs] [float initSpeed]</p>
<div class="highlight"><pre><code class="language-" data-lang="">takes control, starts drone, initializes PTAM. That is:
- starts the drone &amp; and waits riseTimeMs, the drone will rise to approx. 
  a height of 1m. 
- initializes PTAM by taking the first KF, flying up (sending initSpeed as control command) for moveTimeMS, 
  waiting waitTimeMS and then taking the second KF. 
  This is done until success (flying up and down respectively).
- good default values are "autoInit 500 800 4000 0.5" 
</code></pre></div>
</li>
<li>
<p>setInitialYaw [double yaw]</p>
<div class="highlight"><pre><code class="language-" data-lang="">sets the yaw the drone is started at.  Most useful with the ardrone 2.0
with absolute yaw control, as it allows you to specify some other yaw
as the zero point rather than due north.
</code></pre></div>
</li>
<li>
<p>autoTakeover [int moveTimeMS] [int waitTimeMS] [int riseTimeMs] [float initSpeed]</p>
<div class="highlight"><pre><code class="language-" data-lang="">takes control, initializes PTAM. The same as autoInit ..., 
but to be used when the drone is already flying (skipps the first step).
</code></pre></div>
</li>
<li>
<p>takeoff </p>
<div class="highlight"><pre><code class="language-" data-lang="">- takes control, starts drone.
- does not reset map or initialize PTAM
</code></pre></div>
</li>
<li>
<p>setReference [doube x] [double y] [double z] [double yaw]</p>
<div class="highlight"><pre><code class="language-" data-lang="">sets reference point (used in goto X X X X).
</code></pre></div>
</li>
<li>
<p>setMaxControl [double cap = 1.0]</p>
<div class="highlight"><pre><code class="language-" data-lang="">maximal control sent is capped at [cap], causing the drone to fly slower.
</code></pre></div>
</li>
<li>
<p>setInitialReachDist [double dist = 0.2]</p>
<div class="highlight"><pre><code class="language-" data-lang="">drone has to come this close to a way point initially
</code></pre></div>
</li>
<li>
<p>setStayWithinDist [double dist = 0.5]</p>
<div class="highlight"><pre><code class="language-" data-lang="">drone has to stay this close to a way point for a certain amount of time.
</code></pre></div>
</li>
<li>
<p>setStayTime [double seconds = 2.0]</p>
<div class="highlight"><pre><code class="language-" data-lang="">time the drone has to stay within [stayWithinDist] for target to be reached.
</code></pre></div>
</li>
<li>
<p>clearCommands</p>
<div class="highlight"><pre><code class="language-" data-lang="">clears all targets, such that the next command is executed immediately.
</code></pre></div>
</li>
<li>
<p>goto [doube x] [double y] [double z] [double yaw]</p>
<div class="highlight"><pre><code class="language-" data-lang="">flies to position (x,y,z yaw), relative to current reference point.
blocks until target is reached according to set parameters
</code></pre></div>
</li>
<li>
<p>moveBy [doube x] [double y] [double z] [double yaw]</p>

<p>moves by (x,y,z,yaw), relative to the current target position
    blocks until target is reached according to set parameters</p>
</li>
<li>
<p>moveByRel [doube x] [double y] [double z] [double yaw]</p>

<p>moves by (x,y,z,yaw), relative to the current estimated position 
    of the drone
    blocks until target is reached according to set parameters</p>
</li>
<li>
<p>land</p>

<p>initializes landing (use auto-land of drone)</p>
</li>
<li>
<p>lockScaleFP</p>

<p>sets the one point that does not change when the scale is re-estimated 
    to the current drone position. The scaleFP can only be set when PTAM is 
    good, i.e. this is delayed until PTAM is initialized and good.
    Need to set useWorldFixpoint in dynammic_reconfigure.</p>
</li>
</ul>

<h3 id="drone_gui">drone_gui</h3>

<p>This node offers a simple QT GUI to control the <a href="#drone_autopilot">drone_autopilot</a> node, the <a href="#drone_stateestimation">drone_stateestimation</a> node and fly the drone manually via keyboard or joystick.</p>

<h4 id="subscribed-topics"> Subscribed topics</h4>

<ul>
<li>/cmd_vel</li>
<li>/uga_tum_ardrone/com</li>
<li>/ardrone/takeoff</li>
<li>/ardrone/land</li>
<li>/ardrone/reset</li>
<li>/ardrone/predictedPose</li>
<li>/ardrone/navdata</li>
<li>/joy</li>
</ul>

<h4 id="published-topics">Published topics</h4>

<ul>
<li>/cmd_vel</li>
<li>/uga_tum_ardrone/com</li>
<li>/ardrone/takeoff</li>
<li>/ardrone/land</li>
<li>/ardrone/reset</li>
</ul>

<h4 id="services">Services</h4>

<ul>
<li>calls /ardrone/togglecam</li>
<li>calls /ardrone/flattrim</li>
</ul>

<h4 id="parameters"> Parameters</h4>

<ul>
<li><p>DroneIP: IP address to periodically ping in order to estimate the latency of drone control. DO NO IGNORE THIS PARAMETER, it significantly affects performance.</p></li>
<li><p>KBsensRP: Sensitivity for roll/pitch Keyboard control</p></li>
<li><p>KBsensYaw: Sensitivity for yaw Keyboard control</p></li>
<li><p>KBsensGAZ: Sensitivity for gaz Keyboard control</p></li>
</ul>

<h4 id="required-tf-transforms"> Required tf transforms</h4>

<p>None</p>

<h4 id="provided-tf-transforms"> Provided tf transforms</h4>

<p>None</p>

<h4 id="using-it">Using it</h4>

<p><img src="http://wiki.ros.org/tum_ardrone/drone_gui?action=AttachFile&amp;do=get&amp;target=ui.png" alt="Drone GUI"></p>

<h6 id="monitor-drone-autopilot-and-stateestimation-nodes-top-right-part">Monitor Drone, Autopilot and Stateestimation Nodes (top-right part).</h6>

<p>On the top-right, the current publish-frequency of important topics is displayed:
- Drone Navdata: monitors /ardrone/navdata. Should be around 150 to 200Hz with a connected drone, and running (and correctly configured) ardrone_autonomy node.
- Drone Control: monitors /cmd_vel. This is the frequency of how often control commands are published (and sent to the drone).
- Pose Estimates: monitors /ardrone/predictedPose. These are the state predictions generated by the drone_stateestimation node. By default, this should be 30Hz.
- Joy Input: monitors /joy. If you have a connected game-pad and running joy_node, this should be different from 0Hz.
- Pings (RTT): current wireless LAN latency (RTT in ms) for 500B and 20kB packages. If these are too high, reduce Wlan clutter.</p>

<h6 id="manual-or-joystick-control-of-the-drone">Manual or joystick control of the drone.</h6>

<p>The current control source has to be set (i.e. joystick or KB). The autopilot is only allowed to send control commands, if this is set to autopilot.</p>

<ul>
<li>
<p>Joystick control requires a connected joystick and running "rosrun joy joy_node". We use a PS3 sixaxis controller.
to make the controller work, a small linux-hack is required (set controller rights).</p>

<ul>
<li>left joystick is horizontal pos. control; right joystick is height and yaw control.</li>
<li>L1 to take off, release L1 to land.</li>
<li>R1 to toggle emergency state.
=&gt; by moving any of the two joysticks, the Control Source is immediately sent to Joystick.
can be used for safety (autopilot does wired stuff -&gt; immediately take over, disabling the autopilot and enabeling manual control).</li>
</ul>
</li>
<li>
<p>KB control requires the GUI window to have focus, but NOT the upper-left text field.
=&gt; make the GUI the active window and press ESC to immediately enable KB control and set focus such that KB control works properly.
 can be used for safety (autopilot does wired stuff -&gt; press ESC and immediately take over, disabling the autopilot and enabeling manual control).</p>

<ul>
<li>q,a: fly up &amp; down.</li>
<li>i,j,k,l: fly horizontally.</li>
<li>u,o: rotate yaw.</li>
<li>F1: toggle emergency</li>
<li>s: takeoff</li>
<li>d: land</li>
</ul>
</li>
<li><p>Buttons Land, Takeoff, ToggleCam, Emergency (toggles emergency state).</p></li>
</ul>

<h6 id="autopilot-control">Autopilot Control</h6>

<ul>
<li>write commands in top-left text field (or load eample from one of the files). You can simply add .txt files to flightplans/.</li>
<li>click Send to transmit commands to the autopilot's command queue (automatically sets Control Source to Autopilot).</li>
<li>click Clear to clear autopilot command queue and current target.</li>
<li>click Reset to reset Autopilot, PTAM and EKF.</li>
</ul>

<h2 id="troubleshooting">Troubleshooting</h2>

<ul>
<li>if drone doesnt start:

<ul>
<li>battery empty? (drone does not start if battery &lt; ~18%)</li>
<li>Drone in emergency state? (if so, the four led's are red. click Emergency to reset).</li>
</ul>
</li>
<li>cannot control drone:

<ul>
<li>selected correct control source? maybe re-select.</li>
</ul>
</li>
<li>drone flies unstable using the autopilot:

<ul>
<li>adjust / reduce control parameters using dynamic_reconfigure (see readme_autopilot).</li>
</ul>
</li>
<li>drone broken: buy a new one.</li>
</ul>

<h2 id="known-bugs-amp-issues">Known Bugs &amp; Issues</h2>

<ul>
<li>as the software was originally developed for the Ar.Drone 1.0, the pressure sensor and magnetometer are not used.</li>
<li>drone_stateestimation crashes occasionally when PTAM init fails (crash occurs in PTAM code). 
Happens in oarticular if there is no baseline in between the first two keyframes, hardly ever happens in praxis.</li>
</ul>

<h2 id="tips-and-tricks">Tips and Tricks</h2>

<h4 id="camera-calibration">Camera calibration</h4>

<ul>
<li>front, old drone: 0.672049, 0.899033, 0.502065, 0.513876, 0.271972</li>
<li>front, new drone: 0.771557, 1.368560, 0.552779, 0.444056, 1.156010</li>
</ul>

<p>calibrate with ethzasl_ptam.
to work with colored images, in src/CameraCalibrator.cc change:
- add #include <cv_bridge>
- change function imageCallback(...) to</cv_bridge></p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="n">CameraCalibrator</span><span class="o">::</span><span class="n">imageCallback</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span> <span class="o">&amp;</span> <span class="n">img</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">cv_bridge</span><span class="o">::</span><span class="n">CvImagePtr</span> <span class="n">cv_ptr</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">::</span><span class="n">toCvCopy</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">image_encodings</span><span class="o">::</span><span class="n">MONO8</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">mCurrentImage</span><span class="p">.</span><span class="n">size</span><span class="p">().</span><span class="n">x</span> <span class="o">!=</span> <span class="n">img</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">||</span> <span class="n">mCurrentImage</span><span class="p">.</span><span class="n">size</span><span class="p">().</span><span class="n">y</span> <span class="o">!=</span> <span class="n">img</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">)</span>
        <span class="n">mCurrentImage</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">CVD</span><span class="o">::</span><span class="n">ImageRef</span><span class="p">(</span><span class="n">img</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">,</span> <span class="n">img</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">));</span>

    <span class="n">memcpy</span><span class="p">(</span><span class="n">mCurrentImage</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="n">cv_ptr</span><span class="o">-&gt;</span><span class="n">image</span><span class="p">.</span><span class="n">data</span><span class="p">,</span><span class="n">img</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">*</span> <span class="n">img</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">);</span>

    <span class="n">mNewImage</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div>
<h4 id="parameters-c1-to-c8">Parameters: c1 to c8</h4>

<p>can be estimated easily by 
- recording a flight: rosbag record -O calibFlight.bag /ardrone/image_raw /ardrone/navdata /cmd_vel
- playing back that flight: rosbag play -l calibFlight.bag
- starting two stateestimation nodes, one with remapped name and output:
  - rosrun uga_tum_ardrone drone_stateestimation _<em>name:=drone_stateestimationn2 /ardrone/predictedPose:=/ardrone/predictedPose2
  - rosrun uga_tum_ardrone drone_stateestimation
- plotting the respective estimated values
  - e.g.: rxplot /ardrone/predictedPose/dx,/ardrone/predictedPose2/dx
- using dynamic reconfigure to 
  - in drone</em>stateestimation2, use only control gains
  - in drone_stateestimation, use NO control gains, but instead navdata / speeds / PTAM.
- setting c_i in drone_stateestimation2 such that graphs match best (play around).</p>

<h4 id="parameters-pid-control">Parameters: PID control</h4>

<p>approximate in "simulation" based on c1 to c8:
- play back any record, to make stateestimation run (dont play /cmd_vel)
  - rosbag play -l calibFlightZ.bag --topics /ardrone/image_raw /ardrone/navdata
- run stateestimation, in dynamic reconfigure set only control updates to be used
- run gui and autopilot, and control
- plot control / respective pose e.g. with 
  - rxplot /ardrone/predictedPose/yaw /cmd_vel/angular/z</p>

<h2 id="licence">Licence</h2>

<p>The major part of this software package - that is everything except PTAM - is licensed under the GNU General Public License Version 3 (GPLv3), see <a href="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</a>. PTAM (comprised of all files in /src/stateestimation/PTAM) has it's own licence, see <a href="http://www.robots.ox.ac.uk/%7Egk/PTAM/download.html">http://www.robots.ox.ac.uk/~gk/PTAM/download.html</a>. This licence in particular prohibits commercial use of the software.</p>
</div></body></html>

            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-hydro">
    <div class="container-fluid">
      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            

  <table class="table table-condensed">
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/thinclab/uga_tum_ardrone.git">https://github.com/thinclab/uga_tum_ardrone.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">hydro-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2015-12-10
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-default">UNRELEASED
        </span>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/tum_ardrone/github-thinclab-uga_tum_ardrone">tum_ardrone</a></td>
                    <td>0.0.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="rendered-markdown">
<h1 id="package-tum_ardrone">Package tum_ardrone</h1>

<p>This package contains the implementation corresponding to the following publications:</p>

<ul>
<li>
<a href="https://vision.in.tum.de/_media/spezial/bib/engel14ras.pdf">Scale-Aware Navigation of a Low-Cost Quadrocopter with a Monocular Camera</a> (J. Engel, J. Sturm, D. Cremers)</li>
<li>
<a href="https://vision.in.tum.de/_media/spezial/bib/engel12iros.pdf">Camera-Based Navigation of a Low-Cost Quadrocopter</a> (J. Engel, J. Sturm, D. Cremers)</li>
<li>
<a href="https://vision.in.tum.de/_media/spezial/bib/engel12vicomor.pdf">Accurate Figure Flying with a Quadrocopter Using Onboard Visual and Inertial Sensing</a> (J. Engel, J. Sturm, D. Cremers) </li>
</ul>

<p>You can find a <a href="https://www.youtube.com/watch?feature=player_embedded&amp;v=eznMokFQmpc">video</a> on <em>youtube</em>.
This Package builds on the well known monocular SLAM framework PTAM presented by Klein &amp; Murray in their paper at ISMAR07. Please study the original PTAM website and the corresponding paper for more information on this part of the software. Also, be aware of the license that comes with it. </p>

<p>The code works for both the AR.Drone 1.0 and 2.0, the default-parameters however are optimized for the AR.Drone 2.0 by now.</p>

<h2 id="installation">Installation</h2>

<h3 id="with-catkin">with catkin</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd </span>catkin_ws/src
git clone https://github.com/tum-vision/tum_ardrone.git -b hydro-devel
<span class="nb">cd</span> ..
rosdep install tum_ardrone
catkin_make

</code></pre></div>
<h2 id="quick-start">Quick start</h2>

<h4 id="launch-the-nodes">Launch the nodes</h4>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">roslaunch tum_ardrone ardrone_driver.launch
roslaunch tum_ardrone tum_ardrone.launch

</code></pre></div>
<h4 id="check-status">Check status</h4>

<p>On the GUI, under Drone Communication Status, you should see:
- Drone Navdata: XHz (X &gt; 100)
- Pose Estimates: 33Hz</p>

<h4 id="keyboard-control">Keyboard control</h4>

<ul>
<li>focus drone_gui window</li>
<li>press ESC to activate KB control</li>
<li>fly around with KB (see <a href="#drone_gui">drone_gui</a> for key assignments)</li>
</ul>

<h4 id="joystick-control">Joystick control</h4>

<ul>
<li>rosrun joy joy_node</li>
<li>press PS button on controller to activate it</li>
<li>fly around (see <a href="#drone_gui">drone_gui</a> for key assignments)</li>
</ul>

<h4 id="autopilot">Autopilot</h4>

<ul>
<li>type command "autoInit 500 800" in top-left text-field</li>
<li>click Clear and Send (maybe click Reset first)
=&gt; drone will takeoff &amp; init PTAM, then hold position.</li>
<li>click on video to interactively set target (relative to current position); see <a href="#drone_stateestimation">drone_stateestimation</a>
=&gt; first fly up 1m and then down 1m to facilitate a good scale estimate, dont start e.g. by flying horizontally over uneven terrain (!).</li>
<li>always have a finger on ESC or on the joystick for emergency-keyboard control :)</li>
</ul>

<h2 id="nodes">Nodes</h2>

<h3 id="drone_stateestimation">drone_stateestimation</h3>

<p>Estimates the drone's position based on sent navdata, sent control commands and PTAM.</p>

<blockquote>
<p>IMPORTANT: requires messages to be sent on both /ardrone/navdata (&gt;100Hz) and /ardrone/image_raw (&gt;10Hz), i.e. a connected drone with running ardrone_autonomy node, or a .bag replay of at least those two channels. ardrone_autonomy should be started with:</p>
</blockquote>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rosrun ardrone_autonomy ardrone_driver _navdata_demo:<span class="o">=</span>0 _loop_rate:<span class="o">=</span>500

</code></pre></div>
<h4 id="subscribed-topics"> Subscribed topics</h4>

<ul>
<li>/ardrone/navdata</li>
<li>/ardrone/image_raw</li>
<li>/cmd_vel</li>
<li>/tum_ardrone/com</li>
</ul>

<h4 id="published-topics">Published topics</h4>

<ul>
<li>/ardrone/predictedPose</li>
<li>/tum_ardrone/com</li>
</ul>

<h4 id="services">Services</h4>

<p>None</p>

<h4 id="parameters"> Parameters</h4>

<ul>
<li>~publishFreq: frequency, at which the drone's estimated position is calculated &amp; published. Default: 30Hz</li>
<li>~calibFile: camera calibration file. If not set, the defaults are used (camcalib/ardroneX_default.txt).</li>
<li>UseControlGains: whether to use control gains for EKF prediction.</li>
<li>UsePTAM: whether to use PTAM pose estimates as EKF update</li>
<li>
<p>UseNavdata: whether to use Navdata information for EKF update</p>

<blockquote>
<p>UsePTAM and UseNavdata are set to false, the EKF is never updated and acts as a pure simulator, prediciting the pose based on the control commands received (on /cmd_vel). Nice for experimenting.</p>
</blockquote>
</li>
<li><p>PTAMMapLock: lock PTAM map (no more KF)</p></li>
<li><p>PTAMSyncLock: lock PTAM map sync (fix scale and pose offsets etc.)</p></li>
<li><p>PTAMMaxKF: maximum amount of KF PTAM takes. </p></li>
<li><p>PTAMMinKFDist: min. distance between two KF (in meters)</p></li>
<li><p>PTAMMinKFWiggleDist: min. distance between two KF (relative to mean scene depth).</p></li>
<li>
<p>PTAMMinKFTimeDiff: min time between two KF.</p>

<blockquote>
<p>PTAM takes a new KF if (PTAMMinKFTimeDiff AND (PTAMMinKFDist OR PTAMMinKFWiggleDist)), and tracking is good etc.</p>
</blockquote>
</li>
<li><p>RescaleFixOrigin: If the scale of the Map is reestimated, only one point in the mapping PTAM &lt;-&gt; World remains fixed.
If RescaleFixOrigin == false, this is the current pos. of the drone (to avoid sudden, large "jumps"). this however makes the map "drift".
If RescaleFixOrigin == true, by default this is the initialization point where the second KF has been taken (drone pos. may jump suddenly, but map remains fixed.). The fixpoint may be set by the command "lockScaleFP".</p></li>
<li><p>c1 ... c8: prediction model parameters of the EKF. see "Camera-Based Navigation of a Low-Cost Quadrocopter"</p></li>
</ul>

<h4 id="required-tf-transforms"> Required tf transforms</h4>

<p>TODO</p>

<h4 id="provided-tf-transforms"> Provided tf transforms</h4>

<p>TODO</p>

<h4 id="using-it">Using it</h4>

<p>To properly estimate PTAM's scale, it is best to fly up and down a little bit (e.g. 1m up and 1m down) immediately after initialization.
There are two windows, one shows the video and PTAM's map points, the other one the map. To issue key commands, focus the respective window and hit a key. This generates a command on /tum_ardrone/com, which in turn is parsed and does something.</p>

<h6 id="video-window">Video Window</h6>

<p><img src="http://wiki.ros.org/tum_ardrone/drone_stateestimation?action=AttachFile&amp;do=get&amp;target=video.png" alt="Video window"></p>

<table>
<thead>
<tr>
<th>Key</th>
<th>/tum_adrone/com message</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>"p reset"</td>
<td>resets PTAM</td>
</tr>
<tr>
<td>u</td>
<td>"p toggleUI"</td>
<td>changes view</td>
</tr>
<tr>
<td>space</td>
<td>"p space"</td>
<td>takes first / second Keyframe for PTAM's initialization</td>
</tr>
<tr>
<td>k</td>
<td>"p keyframe"</td>
<td>forces PTAM to take a keyframe</td>
</tr>
<tr>
<td>l</td>
<td>"toggleLog"</td>
<td>starts / stops extensive logging of all kinds of values to a file</td>
</tr>
<tr>
<td>m</td>
<td>"p toggleLockMap"</td>
<td>locks map, equivalent to parameter PTAMMapLock</td>
</tr>
<tr>
<td>n</td>
<td>"p toggleLockSync"</td>
<td>locks sync, equivalent to parameter PTAMSyncLock</td>
</tr>
</tbody>
</table>

<p>Clicking on the video window will generate waypoints, which are sent to drone_autopilot (if running):
- left-click: fly (x,y,0)m relative to the current position. image-center is (0,0), borders are 2m respectively.
- right-click: fly (0,0,y)m and rotate yaw by x degree. image-center is (0,0), borders are 2m and 90 degree respectively.</p>

<h6 id="map-window">Map Window</h6>

<p><img src="http://wiki.ros.org/tum_ardrone/drone_stateestimation?action=AttachFile&amp;do=get&amp;target=map.png" alt="Map window"></p>

<table>
<thead>
<tr>
<th>Key</th>
<th>/tum_adrone/com message</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>"f reset"</td>
<td>resets EKF and PTAM</td>
</tr>
<tr>
<td>u</td>
<td>"m toggleUI"</td>
<td>changes view</td>
</tr>
<tr>
<td>v</td>
<td>"m resetView"</td>
<td>resets viewpoint of viewer</td>
</tr>
<tr>
<td>l</td>
<td>"toggleLog"</td>
<td>starts / stops extensive logging of all kinds of values to a file</td>
</tr>
<tr>
<td>v</td>
<td>"m clearTrail"</td>
<td>clears green drone-trail</td>
</tr>
</tbody>
</table>

<h3 id="drone_autopilot">drone_autopilot</h3>

<p>PID controller for the drone. Also includes basic way-point-following and automatic initialization. Requires <a href="#drone_stateestimation">drone_stateestimation</a> to be running. The target is set via the /tum_ardrone/com topic.</p>

<h4 id="subscribed-topics"> Subscribed topics</h4>

<ul>
<li>/ardrone/predictedPose</li>
</ul>

<h4 id="published-topics">Published topics</h4>

<ul>
<li>/cmd_vel</li>
<li>/ardrone/land</li>
<li>/ardrone/takeoff</li>
<li>/ardrone/reset</li>
</ul>

<h4 id="services">Services</h4>

<p>None</p>

<h4 id="parameters"> Parameters</h4>

<ul>
<li>~minPublishFreq: usually, a control command is sent for each pose estimate received from drone_stateestimation. However, if no pose estimate is received for more than minPublishFreq milliseconds, a HOVER command is sent, causing the drone to hover if for example drone_stateestimation is shut down suddenly. Default: 110.</li>
<li>Ki_X, Kd_X, Kp_X: PID controller parameters for roll/pitch, gaz (up/down) and yaw.</li>
<li>max_X: maximal respective control command sent (ever).</li>
<li>rise_fac: rise commands are larger than respective drop commands by this factor. This is due to the drone sometimes dropping unpredictably fast for large drop commands, however rising somethimes requires large rise commands.
aggressiveness: multiplied to PI-component of all commands sent. Low values lead to the drone flying "slower".</li>
</ul>

<h4 id="required-tf-transforms"> Required tf transforms</h4>

<p>TODO</p>

<h4 id="provided-tf-transforms"> Provided tf transforms</h4>

<p>TODO</p>

<h4 id="using-it">Using it</h4>

<p>The behavior of the autopilot is set by sending commands on /tum_ardrone/com of the form "c COMMAND". A Queue of commands is kept, and as soon as one command is finished (for example a way point reached), the next command is popped. The queue can be cleared by sending "c clearCommands". Commands can be sent using the <a href="#drone_gui">drone_gui</a> node. Some example scripts can be found in /flightPlans/*.txt. Possible commands are:</p>

<ul>
<li>
<p>autoInit [int moveTimeMS] [int waitTimeMS] [int riseTimeMs] [float initSpeed]</p>
<div class="highlight"><pre><code class="language-" data-lang="">takes control, starts drone, initializes PTAM. That is:
- starts the drone &amp; and waits riseTimeMs, the drone will rise to approx. 
  a height of 1m. 
- initializes PTAM by taking the first KF, flying up (sending initSpeed as control command) for moveTimeMS, 
  waiting waitTimeMS and then taking the second KF. 
  This is done until success (flying up and down respectively).
- good default values are "autoInit 500 800 4000 0.5" 
</code></pre></div>
</li>
<li>
<p>autoTakeover [int moveTimeMS] [int waitTimeMS] [int riseTimeMs] [float initSpeed]</p>
<div class="highlight"><pre><code class="language-" data-lang="">takes control, initializes PTAM. The same as autoInit ..., 
but to be used when the drone is already flying (skipps the first step).
</code></pre></div>
</li>
<li>
<p>takeoff </p>
<div class="highlight"><pre><code class="language-" data-lang="">- takes control, starts drone.
- does not reset map or initialize PTAM
</code></pre></div>
</li>
<li>
<p>setReference [doube x] [double y] [double z] [double yaw]</p>
<div class="highlight"><pre><code class="language-" data-lang="">sets reference point (used in goto X X X X).
</code></pre></div>
</li>
<li>
<p>setMaxControl [double cap = 1.0]</p>
<div class="highlight"><pre><code class="language-" data-lang="">maximal control sent is capped at [cap], causing the drone to fly slower.
</code></pre></div>
</li>
<li>
<p>setInitialReachDist [double dist = 0.2]</p>
<div class="highlight"><pre><code class="language-" data-lang="">drone has to come this close to a way point initially
</code></pre></div>
</li>
<li>
<p>setStayWithinDist [double dist = 0.5]</p>
<div class="highlight"><pre><code class="language-" data-lang="">drone has to stay this close to a way point for a certain amount of time.
</code></pre></div>
</li>
<li>
<p>setStayTime [double seconds = 2.0]</p>
<div class="highlight"><pre><code class="language-" data-lang="">time the drone has to stay within [stayWithinDist] for target to be reached.
</code></pre></div>
</li>
<li>
<p>clearCommands</p>
<div class="highlight"><pre><code class="language-" data-lang="">clears all targets, such that the next command is executed immediately.
</code></pre></div>
</li>
<li>
<p>goto [doube x] [double y] [double z] [double yaw]</p>
<div class="highlight"><pre><code class="language-" data-lang="">flies to position (x,y,z yaw), relative to current reference point.
blocks until target is reached according to set parameters
</code></pre></div>
</li>
<li>
<p>moveBy [doube x] [double y] [double z] [double yaw]</p>

<p>moves by (x,y,z,yaw), relative to the current target position
    blocks until target is reached according to set parameters</p>
</li>
<li>
<p>moveByRel [doube x] [double y] [double z] [double yaw]</p>

<p>moves by (x,y,z,yaw), relative to the current estimated position 
    of the drone
    blocks until target is reached according to set parameters</p>
</li>
<li>
<p>land</p>

<p>initializes landing (use auto-land of drone)</p>
</li>
<li>
<p>lockScaleFP</p>

<p>sets the one point that does not change when the scale is re-estimated 
    to the current drone position. The scaleFP can only be set when PTAM is 
    good, i.e. this is delayed until PTAM is initialized and good.
    Need to set useWorldFixpoint in dynammic_reconfigure.</p>
</li>
</ul>

<h3 id="drone_gui">drone_gui</h3>

<p>This node offers a simple QT GUI to control the <a href="#drone_autopilot">drone_autopilot</a> node, the <a href="#drone_stateestimation">drone_stateestimation</a> node and fly the drone manually via keyboard or joystick.</p>

<h4 id="subscribed-topics"> Subscribed topics</h4>

<ul>
<li>/cmd_vel</li>
<li>/tum_ardrone/com</li>
<li>/ardrone/takeoff</li>
<li>/ardrone/land</li>
<li>/ardrone/reset</li>
<li>/ardrone/predictedPose</li>
<li>/ardrone/navdata</li>
<li>/joy</li>
</ul>

<h4 id="published-topics">Published topics</h4>

<ul>
<li>/cmd_vel</li>
<li>/tum_ardrone/com</li>
<li>/ardrone/takeoff</li>
<li>/ardrone/land</li>
<li>/ardrone/reset</li>
</ul>

<h4 id="services">Services</h4>

<ul>
<li>calls /ardrone/togglecam</li>
<li>calls /ardrone/flattrim</li>
</ul>

<h4 id="parameters"> Parameters</h4>

<p>None</p>

<h4 id="required-tf-transforms"> Required tf transforms</h4>

<p>None</p>

<h4 id="provided-tf-transforms"> Provided tf transforms</h4>

<p>None</p>

<h4 id="using-it">Using it</h4>

<p><img src="http://wiki.ros.org/tum_ardrone/drone_gui?action=AttachFile&amp;do=get&amp;target=ui.png" alt="Drone GUI"></p>

<h6 id="monitor-drone-autopilot-and-stateestimation-nodes-top-right-part">Monitor Drone, Autopilot and Stateestimation Nodes (top-right part).</h6>

<p>On the top-right, the current publish-frequency of important topics is displayed:
- Drone Navdata: monitors /ardrone/navdata. Should be around 150 to 200Hz with a connected drone, and running (and correctly configured) ardrone_autonomy node.
- Drone Control: monitors /cmd_vel. This is the frequency of how often control commands are published (and sent to the drone).
- Pose Estimates: monitors /ardrone/predictedPose. These are the state predictions generated by the drone_stateestimation node. By default, this should be 30Hz.
- Joy Input: monitors /joy. If you have a connected game-pad and running joy_node, this should be different from 0Hz.
- Pings (RTT): current wireless LAN latency (RTT in ms) for 500B and 20kB packages. If these are too high, reduce Wlan clutter.</p>

<h6 id="manual-or-joystick-control-of-the-drone">Manual or joystick control of the drone.</h6>

<p>The current control source has to be set (i.e. joystick or KB). The autopilot is only allowed to send control commands, if this is set to autopilot.</p>

<ul>
<li>
<p>Joystick control requires a connected joystick and running "rosrun joy joy_node". We use a PS3 sixaxis controller.
to make the controller work, a small linux-hack is required (set controller rights).</p>

<ul>
<li>left joystick is horizontal pos. control; right joystick is height and yaw control.</li>
<li>L1 to take off, release L1 to land.</li>
<li>R1 to toggle emergency state.
=&gt; by moving any of the two joysticks, the Control Source is immediately sent to Joystick.
can be used for safety (autopilot does wired stuff -&gt; immediately take over, disabling the autopilot and enabeling manual control).</li>
</ul>
</li>
<li>
<p>KB control requires the GUI window to have focus, but NOT the upper-left text field.
=&gt; make the GUI the active window and press ESC to immediately enable KB control and set focus such that KB control works properly.
 can be used for safety (autopilot does wired stuff -&gt; press ESC and immediately take over, disabling the autopilot and enabeling manual control).</p>

<ul>
<li>q,a: fly up &amp; down.</li>
<li>i,j,k,l: fly horizontally.</li>
<li>u,o: rotate yaw.</li>
<li>F1: toggle emergency</li>
<li>s: takeoff</li>
<li>d: land</li>
</ul>
</li>
<li><p>Buttons Land, Takeoff, ToggleCam, Emergency (toggles emergency state).</p></li>
</ul>

<h6 id="autopilot-control">Autopilot Control</h6>

<ul>
<li>write commands in top-left text field (or load eample from one of the files). You can simply add .txt files to flightplans/.</li>
<li>click Send to transmit commands to the autopilot's command queue (automatically sets Control Source to Autopilot).</li>
<li>click Clear to clear autopilot command queue and current target.</li>
<li>click Reset to reset Autopilot, PTAM and EKF.</li>
</ul>

<h2 id="troubleshooting">Troubleshooting</h2>

<ul>
<li>if drone doesnt start:

<ul>
<li>battery empty? (drone does not start if battery &lt; ~18%)</li>
<li>Drone in emergency state? (if so, the four led's are red. click Emergency to reset).</li>
</ul>
</li>
<li>cannot control drone:

<ul>
<li>selected correct control source? maybe re-select.</li>
</ul>
</li>
<li>drone flies unstable using the autopilot:

<ul>
<li>adjust / reduce control parameters using dynamic_reconfigure (see readme_autopilot).</li>
</ul>
</li>
<li>drone broken: buy a new one.</li>
</ul>

<h2 id="known-bugs-amp-issues">Known Bugs &amp; Issues</h2>

<ul>
<li>as the software was originally developed for the Ar.Drone 1.0, the pressure sensor and magnetometer are not used.</li>
<li>drone_stateestimation crashes occasionally when PTAM init fails (crash occurs in PTAM code). 
Happens in oarticular if there is no baseline in between the first two keyframes, hardly ever happens in praxis.</li>
</ul>

<h2 id="tips-and-tricks">Tips and Tricks</h2>

<h4 id="camera-calibration">Camera calibration</h4>

<ul>
<li>front, old drone: 0.672049, 0.899033, 0.502065, 0.513876, 0.271972</li>
<li>front, new drone: 0.771557, 1.368560, 0.552779, 0.444056, 1.156010</li>
</ul>

<p>calibrate with ethzasl_ptam.
to work with colored images, in src/CameraCalibrator.cc change:
- add #include <cv_bridge>
- change function imageCallback(...) to</cv_bridge></p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="n">CameraCalibrator</span><span class="o">::</span><span class="n">imageCallback</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span> <span class="o">&amp;</span> <span class="n">img</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">cv_bridge</span><span class="o">::</span><span class="n">CvImagePtr</span> <span class="n">cv_ptr</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">::</span><span class="n">toCvCopy</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">image_encodings</span><span class="o">::</span><span class="n">MONO8</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">mCurrentImage</span><span class="p">.</span><span class="n">size</span><span class="p">().</span><span class="n">x</span> <span class="o">!=</span> <span class="n">img</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">||</span> <span class="n">mCurrentImage</span><span class="p">.</span><span class="n">size</span><span class="p">().</span><span class="n">y</span> <span class="o">!=</span> <span class="n">img</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">)</span>
        <span class="n">mCurrentImage</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">CVD</span><span class="o">::</span><span class="n">ImageRef</span><span class="p">(</span><span class="n">img</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">,</span> <span class="n">img</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">));</span>

    <span class="n">memcpy</span><span class="p">(</span><span class="n">mCurrentImage</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="n">cv_ptr</span><span class="o">-&gt;</span><span class="n">image</span><span class="p">.</span><span class="n">data</span><span class="p">,</span><span class="n">img</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">*</span> <span class="n">img</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">);</span>

    <span class="n">mNewImage</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div>
<h4 id="parameters-c1-to-c8">Parameters: c1 to c8</h4>

<p>can be estimated easily by 
- recording a flight: rosbag record -O calibFlight.bag /ardrone/image_raw /ardrone/navdata /cmd_vel
- playing back that flight: rosbag play -l calibFlight.bag
- starting two stateestimation nodes, one with remapped name and output:
  - rosrun tum_ardrone drone_stateestimation _<em>name:=drone_stateestimationn2 /ardrone/predictedPose:=/ardrone/predictedPose2
  - rosrun tum_ardrone drone_stateestimation
- plotting the respective estimated values
  - e.g.: rxplot /ardrone/predictedPose/dx,/ardrone/predictedPose2/dx
- using dynamic reconfigure to 
  - in drone</em>stateestimation2, use only control gains
  - in drone_stateestimation, use NO control gains, but instead navdata / speeds / PTAM.
- setting c_i in drone_stateestimation2 such that graphs match best (play around).</p>

<h4 id="parameters-pid-control">Parameters: PID control</h4>

<p>approximate in "simulation" based on c1 to c8:
- play back any record, to make stateestimation run (dont play /cmd_vel)
  - rosbag play -l calibFlightZ.bag --topics /ardrone/image_raw /ardrone/navdata
- run stateestimation, in dynamic reconfigure set only control updates to be used
- run gui and autopilot, and control
- plot control / respective pose e.g. with 
  - rxplot /ardrone/predictedPose/yaw /cmd_vel/angular/z</p>

<h2 id="licence">Licence</h2>

<p>The major part of this software package - that is everything except PTAM - is licensed under the GNU General Public License Version 3 (GPLv3), see <a href="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</a>. PTAM (comprised of all files in /src/stateestimation/PTAM) has it's own licence, see <a href="http://www.robots.ox.ac.uk/%7Egk/PTAM/download.html">http://www.robots.ox.ac.uk/~gk/PTAM/download.html</a>. This licence in particular prohibits commercial use of the software.</p>
</div></body></html>

            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-groovy">
    <div class="container-fluid">
      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            

  <table class="table table-condensed">
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/thinclab/uga_tum_ardrone.git">https://github.com/thinclab/uga_tum_ardrone.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">groovy-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2014-04-22
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-default">UNRELEASED
        </span>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/tum_ardrone/github-thinclab-uga_tum_ardrone">tum_ardrone</a></td>
                    <td>0.0.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="rendered-markdown"><div class="highlight"><pre><code class="language-" data-lang="">------------ camera calibration: -----------------------
- front, old drone: 0.672049, 0.899033, 0.502065, 0.513876, 0.271972
- front, new drone: 0.771557, 1.368560, 0.552779, 0.444056, 1.156010

calibrate with ethzasl_ptam.
to work with colored images, in src/CameraCalibrator.cc change:
- add #include &lt;cv_bridge/cv_bridge.h&gt;
- change function imageCallback(...) to
void CameraCalibrator::imageCallback(const sensor_msgs::ImageConstPtr &amp; img)
{
    cv_bridge::CvImagePtr cv_ptr = cv_bridge::toCvCopy(img, sensor_msgs::image_encodings::MONO8);

    if(mCurrentImage.size().x != img-&gt;width || mCurrentImage.size().y != img-&gt;height)
        mCurrentImage.resize(CVD::ImageRef(img-&gt;width, img-&gt;height));

    memcpy(mCurrentImage.data(),cv_ptr-&gt;image.data,img-&gt;width * img-&gt;height);

    mNewImage = true;
}



------------ Parameters: c1 to c8 -----------------------------
can be estimated easily by 
- recording a flight: rosbag record -O calibFlight.bag /ardrone/image_raw /ardrone/navdata /cmd_vel
- playing back that flight: rosbag play -l calibFlight.bag
- starting two stateestimation nodes, one with remapped name and output:
  - rosrun tum_ardrone drone_stateestimation __name:=drone_stateestimationn2 /ardrone/predictedPose:=/ardrone/predictedPose2
  - rosrun tum_ardrone drone_stateestimation
- plotting the respective estimated values
  - e.g.: rxplot /ardrone/predictedPose/dx,/ardrone/predictedPose2/dx
- using dynamic reconfigure to 
  - in drone_stateestimation2, use only control gains
  - in drone_stateestimation, use NO control gains, but instead navdata / speeds / PTAM.
- setting c_i in drone_stateestimation2 such that graphs match best (play around).




------------ Parameters: PID control -----------------------------
approximate in "simulation" based on c1 to c8:
- play back any record, to make stateestimation run (dont play /cmd_vel)
  - rosbag play -l calibFlightZ.bag --topics /ardrone/image_raw /ardrone/navdata
- run stateestimation, in dynamic reconfigure set only control updates to be used
- run gui and autopilot, and control
- plot control / respective pose e.g. with 
  - rxplot /ardrone/predictedPose/yaw /cmd_vel/angular/z





</code></pre></div></div></body></html>

            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-fuerte">
    <div class="container-fluid">
      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            

  <table class="table table-condensed">
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/thinclab/uga_tum_ardrone.git">https://github.com/thinclab/uga_tum_ardrone.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">fuerte-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2014-07-09
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-default">UNRELEASED
        </span>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/uga_tum_ardrone/github-thinclab-uga_tum_ardrone">uga_tum_ardrone</a></td>
                    <td>UNKNOWN</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="rendered-markdown"><div class="highlight"><pre><code class="language-" data-lang="">------------ camera calibration: -----------------------
- front, old drone: 0.672049, 0.899033, 0.502065, 0.513876, 0.271972
- front, new drone: 0.771557, 1.368560, 0.552779, 0.444056, 1.156010

calibrate with ethzasl_ptam.
to work with colored images, in src/CameraCalibrator.cc change:
- add #include &lt;cv_bridge/cv_bridge.h&gt;
- change function imageCallback(...) to
void CameraCalibrator::imageCallback(const sensor_msgs::ImageConstPtr &amp; img)
{
    cv_bridge::CvImagePtr cv_ptr = cv_bridge::toCvCopy(img, sensor_msgs::image_encodings::MONO8);

    if(mCurrentImage.size().x != img-&gt;width || mCurrentImage.size().y != img-&gt;height)
        mCurrentImage.resize(CVD::ImageRef(img-&gt;width, img-&gt;height));

    memcpy(mCurrentImage.data(),cv_ptr-&gt;image.data,img-&gt;width * img-&gt;height);

    mNewImage = true;
}



------------ Parameters: c1 to c8 -----------------------------
can be estimated easily by 
- recording a flight: rosbag record -O calibFlight.bag /ardrone/image_raw /ardrone/navdata /cmd_vel
- playing back that flight: rosbag play -l calibFlight.bag
- starting two stateestimation nodes, one with remapped name and output:
  - rosrun tum_ardrone drone_stateestimation __name:=drone_stateestimationn2 /ardrone/predictedPose:=/ardrone/predictedPose2
  - rosrun tum_ardrone drone_stateestimation
- plotting the respective estimated values
  - e.g.: rxplot /ardrone/predictedPose/dx,/ardrone/predictedPose2/dx
- using dynamic reconfigure to 
  - in drone_stateestimation2, use only control gains
  - in drone_stateestimation, use NO control gains, but instead navdata / speeds / PTAM.
- setting c_i in drone_stateestimation2 such that graphs match best (play around).




------------ Parameters: PID control -----------------------------
approximate in "simulation" based on c1 to c8:
- play back any record, to make stateestimation run (dont play /cmd_vel)
  - rosbag play -l calibFlightZ.bag --topics /ardrone/image_raw /ardrone/navdata
- run stateestimation, in dynamic reconfigure set only control updates to be used
- run gui and autopilot, and control
- plot control / respective pose e.g. with 
  - rxplot /ardrone/predictedPose/yaw /cmd_vel/angular/z





</code></pre></div></div></body></html>

            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-electric">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>electric</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-diamondback">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>diamondback</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>


<script src="/js/distro_switch.js"></script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-4 col-md-4">
          
            <a href="https://github.com/rosindex">
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>

            <span class="username">rosindex</span>
          </a>
          |
          <em>generated on 2016-07-04</em>
        
        </div>
        <div class="col-sm-8 col-md-8 text-right">
          <p class="text">a community-maintained index of robotics software
 | <a href="/privacy.txt">privacy</a></p>
        </div>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
